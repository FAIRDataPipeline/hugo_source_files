<!DOCTYPE html>
<html data-scroll='0' lang="en" dir=ZgotmplZ >

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="fair CLI functions # Note that this is a living document and the following is subject to change.
A simple example of how the data pipline should run from the command line:
fair pull config.yaml fair run config.yaml fair push config.yaml fair pull # download any data required by read: from the remote data store and record metadata in the data registry (whilst editing relevant entries, e.g. storage_root) pull meta data associated with all previous versions of these objects listed in write: from the remote data registry download any data listed in register: from the original source and record metadata in the data registry fair run # read (and validate) the config.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="FAIR CLI functions" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://www.fairdatapipeline.org/docs/interface/fdp/" />

<title>FAIR CLI functions | FAIRDataPipeline</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.6cadb488be70926c21eb85dbe7b904cae7b12a25881b3e44aa9f69d9fe7e5435.css" integrity="sha256-bK20iL5wkmwh64Xb57kEyuexKiWIGz5Eqp9p2f5&#43;VDU=">
<script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk="></script>
<link rel="alternate" type="application/rss+xml" href="https://www.fairdatapipeline.org/docs/interface/fdp/index.xml" title="FAIRDataPipeline" />
<!--
Made with Book Theme
https://github.com/RyanJField/hugo-book
-->
  
  
<script defer type="text/javascript" src="/lunr.min.js"></script>

<script defer src="/en.fancy-search.min.6bf768864f805238cc2c1e4256cec14ea34d30dd665f454c0b3811aba0f00079.js" integrity="sha256-a/dohk&#43;AUjjMLB5CVs7BTqNNMN1mX0VMCzgRq6DwAHk="></script>
<script defer src="/scroll.js"></script>
</head>

<body dir=ZgotmplZ>
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />

  
  <div class="custom-header">  
    <div class="custom-flex container flex">
      <div class="custom-left">
        <div class="custom-brand">
          <h2 class="custom-brand-text">
            <a href="/"><img src="/logo.jpg" alt="Logo" /><span>FAIRDataPipeline</span>
            </a>
          </h2>
          </div> 
        </div>  
      <div class ="custom-search-container">
        
<div class="search-top">
    <div class="search">
        <div class="search-input-wrap">
            <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search FAIRDataPipeline" aria-label="Search FAIRDataPipeline" autocomplete="off">
            <label for="search-input" class="search-label">
              <div class="search-svg">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
                <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
            </div>
            </label>
        </div>
        <div id="search-results" class="search-results"></div>
    </div>
</div>

      </div>
    </div>    
  </div>
  

  <main class="container flex">
    <aside class="book-menu">
      
  <nav>













  



  
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/quick_start/" class="">Quick Start</a>
  

          
  
  
  

  
  <ul>
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/interface/" class="collapsed ">API Interface</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/interface/config/" class="">config.yaml fields</a>
  

          
  
  
  

  
  <ul>
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/interface/example0/" class="">DPAPI examples</a>
  

          
  
  
  

  
  <ul>
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/interface/example1/" class="">DPAPI functions</a>
  

          
  
  
  

  
  <ul>
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/interface/fdp/" class="active">FAIR CLI functions</a>
  

          
  
  
  

  
  <ul>
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/interface/fair_cli_dev/" class="">FAIR CLI readme</a>
  

          
  
  
  

  
  <ul>
    
  </ul>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/data_registry/" class="collapsed ">FAIR Data Registry</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/sync_notes/" class="">Notes on synchronisation</a>
  

          
  
  
  

  
  <ul>
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/API/" class="collapsed ">Modelling APIs</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/jargon_buster/" class="">Jargon buster</a>
  

          
  
  
  

  
  <ul>
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/repository_status/" class="">Repository Status</a>
  

          
  
  
  

  
  <ul>
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/use_cases/" class="collapsed ">Uses cases</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/SCRC/" class="">SCRC</a>
  

          
  
  
  

  
  <ul>
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/edit-site/" class="">Edit this site</a>
  

          
  
  
  

  
  <ul>
    
  </ul>
  

        </li>
      
    
  </ul>
  











  
<ul>
  
  <li>
    <a href="https://www.gla.ac.uk/research/az/scrc/" target="_blank" rel="noopener">
        SCRC UoG
      </a>
  </li>
  
  <li>
    <a href="https://data.fairdatapipeline.org/" target="_blank" rel="noopener">
        Remote Data Registry
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>FAIR CLI functions</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>

  
  <aside class="hidden clearfix">
    
  <nav id="TableOfContents">
  <ul>
    <li><a href="#fair-cli-functions"><code>fair</code> CLI functions</a>
      <ul>
        <li><a href="#fair-pull"><code>fair pull</code></a></li>
        <li><a href="#fair-run"><code>fair run</code></a></li>
        <li><a href="#fair-push"><code>fair push</code></a></li>
      </ul>
    </li>
  </ul>
</nav>


  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="fair-cli-functions">
  <code>fair</code> CLI functions
  <a class="anchor" href="#fair-cli-functions">#</a>
</h1>
<p><span style="font-size:12pt; color:red">Note that this is a living document and the following is subject to change.</span></p>
<p>A simple example of how the data pipline should run from the command line:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">fair pull config.yaml
</span></span><span class="line"><span class="cl">fair run config.yaml
</span></span><span class="line"><span class="cl">fair push config.yaml
</span></span></code></pre></div><h2 id="fair-pull">
  <code>fair pull</code>
  <a class="anchor" href="#fair-pull">#</a>
</h2>
<ul>
<li>download any data required by <code>read:</code> from the remote data store and record metadata in the data registry (whilst editing relevant entries, <em>e.g.</em> <code>storage_root</code>)</li>
<li>pull meta data associated with all previous versions of these objects listed in <code>write:</code> from the remote data registry</li>
<li>download any data listed in <code>register:</code> from the original source and record metadata in the data registry</li>
</ul>
<h2 id="fair-run">
  <code>fair run</code>
  <a class="anchor" href="#fair-run">#</a>
</h2>
<ul>
<li>read (and validate) the <em>config.yaml</em> file</li>
<li>generate a working <em>config.yaml</em> file (see 
  <a href="https://www.fairdatapipeline.org/docs/interface/example1/">Working example</a>)
<ul>
<li>
<p>globbing is used to interpret <code>*</code> as all matching objects as well as the original string returned, <em>e.g.</em> if <code>real/data/1</code> version 0.0.1 and <code>real/data/thing/1</code> version 0.0.1 already exist in the registry, the user-written config:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">write</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">data_product</span><span class="p">:</span><span class="w"> </span><span class="l">real/data/*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">general description for all data products</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">use</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">someone</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l">${{MINOR}}</span><span class="w">
</span></span></span></code></pre></div><p>should return:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">write</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">data_product</span><span class="p">:</span><span class="w"> </span><span class="l">real/data/1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">use</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">data_product</span><span class="p">:</span><span class="w"> </span><span class="l">real/data/1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">general description for all data products</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">0.1.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">someone</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">data_product</span><span class="p">:</span><span class="w"> </span><span class="l">real/data/thing/1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">use</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">data_product</span><span class="p">:</span><span class="w"> </span><span class="l">real/data/thing/1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">general description for all data products</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">0.1.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">someone</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">data_product</span><span class="p">:</span><span class="w"> </span><span class="l">real/data/*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">use</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">data_product</span><span class="p">:</span><span class="w"> </span><span class="l">real/data/*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">general description for all data products</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">0.0.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">someone</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p>specific version numbers and any variables in <code>run_metadata:</code>, <code>register:</code>, <code>read:</code>, and <code>write:</code> are replaced with true values, <em>e.g.</em></p>
<ul>
<li><code>${{CONFIG_DIR}}</code> is replaced by the directory within which the working <em>config.yaml</em> file resides</li>
<li><code>release_date: ${{DATETIME}}</code> is replaced by <code>release_date: 2021-04-14T11:34:37</code> which is a valid form for the registry.</li>
<li><code>version: 0.${{DATE}}.0</code> is replaced by <code>version: 0.20210414.0</code></li>
<li><code>version: ${{PATCH}}</code> should increment version by patch; and</li>
<li><code>version: 0.${{DATETIME-%Y%m%d}}.0</code> or any variants thereof are replaced by an appropriately formatted string.</li>
</ul>
</li>
<li>
<p>if no version is given, then one should be written such that patch is incremented if the data product already exists, otherwise version should be set to 0.0.1.</p>
</li>
<li>
<p><code>register:</code> is removed and <code>external_object</code>s are written to <code>read:</code> as <code>data_product</code>s</p>
</li>
<li>
<p>populate <code>public:</code> field in <code>run_metadata:</code> section (default is <code>true</code>)</p>
</li>
<li>
<p>populate <code>version:</code> field in <code>use:</code> section of whether the user-written config contained the field or not</p>
</li>
</ul>
</li>
<li><code>local_repo:</code> must always be given in the <em>config.yaml</em> file
<ul>
<li>ensure the repo is clean</li>
<li>get the hash of the latest commit and add to the working <em>config.yaml</em> file in <code>run_metadata: latest_commit:</code></li>
<li>if <code>run_metadata: remote_repo:</code> is <code>false</code>, then <code>fair push</code> should copy the repo to the file store</li>
<li>if <code>run_metadata: remote_repo:</code> is absent or doesn&rsquo;t contain a URL, then <code>fair run</code> should try to get the remote repo url from the local repo</li>
<li>note that there are exceptions and the user may reference a script located outside of a repository</li>
</ul>
</li>
<li>save the working <em>config.yaml</em> file in the local data store, in <em>&lt;local_store&gt;/coderun/&lt;date&gt;T&lt;time&gt;/config.yaml</em>, e.g. <em>datastore/coderun/20210625T165552/config.yaml</em></li>
<li>save the submission script to the local data store in <em>&lt;local_store&gt;/coderun/&lt;date&gt;T&lt;time&gt;/script.sh</em>
<ul>
<li>note that <em>config.yaml</em> should contain either <code>script:</code> that should be saved as the submission script, or <code>script_path:</code> that points to the file that should be saved as the submission script</li>
</ul>
</li>
<li>save the path to <em>&lt;local_store&gt;/coderun/&lt;date&gt;T&lt;time&gt;/</em> in the global environment as <code>$FDP_CONFIG_DIR</code> so that it can be picked up by the script that is run after this has been completed</li>
<li>execute the submission script</li>
</ul>
<h2 id="fair-push">
  <code>fair push</code>
  <a class="anchor" href="#fair-push">#</a>
</h2>
<ul>
<li>push new files (generated from <code>write:</code> and <code>register:</code>) to the remote data store</li>
<li>record metadata in the data registry (whilst editing relevant entries, <em>e.g.</em> <code>storage_root</code>)</li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">



  <div><a class="flex align-center" href="https://github.com/FAIRDataPipeline/FDP_hugo/commit/98a4cff67013aa42c582e50bca175fab8575844d" title='Last modified by Kristian ZarÄ™bski | August 18, 2021' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>August 18, 2021</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/FAIRDataPipeline/FDP_hugo/tree/master/content//docs/interface/fdp/_index.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>

</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#fair-cli-functions"><code>fair</code> CLI functions</a>
      <ul>
        <li><a href="#fair-pull"><code>fair pull</code></a></li>
        <li><a href="#fair-run"><code>fair run</code></a></li>
        <li><a href="#fair-push"><code>fair push</code></a></li>
      </ul>
    </li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>

</html>











